# テスト実装方針

このプロジェクトでは、以下のテスト戦略を採用しています。

## 1. ユニットテスト（Vitest + React Testing Library）

### 目的
- 個々のコンポーネントやロジックが期待通りに動作することを確認する
- リグレッションを早期に発見する
- コードの品質を維持する

### テスト対象
- ゲームロジック（`src/lib/game.ts`）
- UIコンポーネント（`src/components/`）

### テスト方針
- **ロジックテスト**：
  - 純粋な関数は入力と出力の関係を検証
  - 状態管理関数は状態の変化を検証
  - エッジケースを含む様々なシナリオをテスト

- **コンポーネントテスト**：
  - レンダリング結果の検証
  - ユーザーインタラクション（クリックなど）のシミュレーション
  - プロップスの変更に対する反応の検証
  - コンポーネントの状態変化の検証

### ディレクトリ構造
```
tests/
  ├── unit/              # ユニットテスト
  │   ├── game.test.ts   # ゲームロジックのテスト
  │   └── Board.test.tsx # Boardコンポーネントのテスト
  └── e2e/               # E2Eテスト
```

## 2. コンポーネントの可視化（Storybook）

### 目的
- コンポーネントの視覚的な検証
- コンポーネントの様々な状態を確認
- コンポーネントのドキュメント化

### テスト対象
- すべてのUIコンポーネント

### テスト方針
- 各コンポーネントの基本的な状態をストーリーとして定義
- バリエーション（異なる状態、プロップス）を網羅
- インタラクティブな操作を可能にする

### ディレクトリ構造
```
src/
  └── components/
      ├── Component.tsx        # コンポーネント
      └── Component.stories.tsx # コンポーネントのストーリー
```

## 3. E2Eテスト（Playwright）

### 目的
- 実際のユーザー体験を模倣したテスト
- 複数のコンポーネントやページの連携を検証
- 実際のブラウザ環境での動作確認

### テスト対象
- ゲーム全体の機能
- ユーザーフロー

### テスト方針
- 主要なユーザーシナリオをカバー
- 複数のブラウザでのテスト
- モバイルデバイスのエミュレーション

### ディレクトリ構造
```
tests/
  └── e2e/
      └── gomoku.spec.ts # ゲーム機能のE2Eテスト
```

## 4. CI/CD（GitHub Actions）

### 目的
- コードの変更ごとに自動的にテストを実行
- 品質の継続的な保証
- デプロイ前の検証

### テスト方針
- プッシュやプルリクエスト時に自動実行
- ユニットテスト、E2Eテスト、Storybookビルドを検証
- テスト結果のレポート

### ファイル構造
```
.github/
  └── workflows/
      └── test.yml # GitHub Actionsの設定
```

## テスト実行コマンド

```bash
# ユニットテスト
pnpm test

# カバレッジ付きテスト
pnpm test:coverage

# Storybook起動
pnpm storybook

# E2Eテスト
pnpm test:e2e

# E2Eテスト（UI）
pnpm test:e2e:ui
```

## ベストプラクティス

1. **テストピラミッド**：
   - 多数のユニットテスト
   - 適度な数のコンポーネントテスト
   - 少数の重要なE2Eテスト

2. **テスト駆動開発（TDD）**：
   - 可能な限り、テストを先に書いてから実装する
   - 「赤（失敗）→緑（成功）→リファクタリング」のサイクルを意識

3. **テストの独立性**：
   - 各テストは他のテストに依存しない
   - テストの順序に依存しない
   - 共有状態に依存しない

4. **テストの可読性**：
   - テスト名は何をテストしているかを明確に示す
   - Arrange-Act-Assert（準備-実行-検証）パターンを使用
   - 複雑なセットアップはヘルパー関数に抽出

5. **モック・スタブの適切な使用**：
   - 外部依存はモック化
   - 複雑な内部依存は必要に応じてスタブ化
   - モックは最小限に抑え、実際の実装に近いテストを心がける
